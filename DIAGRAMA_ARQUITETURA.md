# ğŸ—ï¸ DIAGRAMA VISUAL DA ARQUITETURA

## Fluxo de InicializaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  npm start / npm run                    â”‚
â”‚              (Iniciar Servidor Haxball)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      index.js (main)         â”‚
        â”‚  - Carrega config            â”‚
        â”‚  - Inicia managers           â”‚
        â”‚  - Starts API Server         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚              â”‚
        â–¼                     â–¼              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ config- â”‚         â”‚ room-    â”‚    â”‚ api-     â”‚
   â”‚ manager â”‚         â”‚ manager  â”‚    â”‚ server   â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚              â”‚
        â”‚ loadConfig()        â”‚              â”‚ setupRoutes()
        â”‚                    â”‚              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ configs/       â”‚
         â”‚ default.json   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Arquitetura de Modulos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   APLICAÃ‡ÃƒO HAXBALL BOT                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Config     â”‚    â”‚   Room       â”‚    â”‚   API      â”‚   â”‚
â”‚  â”‚   Manager    â”‚â”€â”€â”€â–¶â”‚   Manager    â”‚â”€â”€â”€â–¶â”‚   Server   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                    â”‚                    â”‚        â”‚
â”‚         â”‚                    â”‚                    â”‚        â”‚
â”‚         â–¼                    â–¼                    â–¼        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ configs/     â”‚    â”‚ HaxballJS    â”‚    â”‚ Express    â”‚   â”‚
â”‚  â”‚ default.json â”‚    â”‚              â”‚    â”‚ Routes     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                             â”‚                    â”‚        â”‚
â”‚                             â”‚                    â”‚        â”‚
â”‚                             â–¼                    â–¼        â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                      â”‚ futsal.js    â”‚    â”‚ Discord    â”‚   â”‚
â”‚                      â”‚ (Game Logic) â”‚    â”‚ Webhooks   â”‚   â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ciclo de Vida de uma Sala

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CICLO DE VIDA DE UMA SALA HAXBALL               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£  CRIAR SALA
   â”œâ”€ POST /rooms
   â”‚  â””â”€ Recebe token + config
   â”‚
   â”œâ”€ updateRoomConfig()
   â”‚  â””â”€ Salva em configs/default.json
   â”‚
   â””â”€ createRoom()
      â””â”€ Passa para HaxballJS


2ï¸âƒ£  INICIALIZAR
   â”œâ”€ HaxballJS cria conexÃ£o
   â”œâ”€ Carrega futsal.js (lÃ³gica do jogo)
   â””â”€ room.onRoomLink()
      â””â”€ Imprime URL da sala


3ï¸âƒ£  OPERANDO
   â”œâ”€ Jogadores entram/saem
   â”œâ”€ Partidas sÃ£o jogadas
   â”œâ”€ Stats sÃ£o salvos
   â”œâ”€ Discord recebe webhooks
   â””â”€ API retorna status


4ï¸âƒ£  REINICIAR
   â”œâ”€ POST /admin-command + restart
   â”œâ”€ deleteRoom()
   â”‚  â””â”€ Desconecta sala
   â””â”€ createRoom()
      â””â”€ Cria nova conexÃ£o


5ï¸âƒ£  DELETAR
   â”œâ”€ DELETE /rooms/:id
   â”œâ”€ deleteRoom()
   â”‚  â””â”€ Desconecta
   â””â”€ deleteRoomConfig()
      â””â”€ Remove de configs/default.json
```

---

## Fluxo de RequisiÃ§Ã£o HTTP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        FLUXO DE UMA REQUISIÃ‡ÃƒO POST /rooms               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Cliente envia:
   POST /rooms
   Authorization: Bearer secret
   Content-Type: application/json
   {
     "id": 1,
     "token": "thr1.ABC...",
     "roomName": "Sala"
   }
            â”‚
            â–¼
2. APIServer recebe
   â”œâ”€ Verifica autenticaÃ§Ã£o
   â”‚  â””â”€ Confere Bearer token
   â”‚
   â””â”€ Valida dados
      â””â”€ Verifica campos obrigatÃ³rios
            â”‚
            â–¼
3. Atualiza configuraÃ§Ã£o
   â”œâ”€ updateRoomConfig()
   â”‚  â””â”€ Salva em JSON
   â”‚
   â””â”€ Notifica RoomManager
            â”‚
            â–¼
4. RoomManager cria/recria sala
   â”œâ”€ Desconecta sala antiga (se existir)
   â”œâ”€ Cria nova conexÃ£o com HaxballJS
   â””â”€ Carrega futsal.js
            â”‚
            â–¼
5. Retorna resposta ao cliente
   {
     "message": "Sala criada/atualizada",
     "id": 1
   }
```

---

## IntegraÃ§Ã£o Pterodactyl

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PTERODACTYL PANEL â†” HAXBALL BOT                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Pterodactyl Panel
      â”‚
      â”‚ 1. Admin clica "Start"
      â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Executa comando â”‚
   â”‚ npm install &&  â”‚
   â”‚ npm start       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  index.js       â”‚
   â”‚  carrega salas  â”‚
   â”‚  de config.json â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ API Server Start â”‚
   â”‚ Porta 3002       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
        â”Œâ”€â”€â”€â”´â”€â”€â”€â”
        â”‚       â”‚
        â–¼       â–¼
    â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚GET  â”‚  â”‚POST      â”‚
    â”‚/    â”‚  â”‚/rooms    â”‚
    â”‚stat â”‚  â”‚(create)  â”‚
    â”‚us   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”˜

Admin pode:
  â€¢ Ver status em tempo real
  â€¢ Criar salas via API
  â€¢ Reiniciar salas
  â€¢ Deletar salas
  â€¢ Verificar jogadores online
```

---

## Estrutura de Arquivos

```
haxball-bot/
â”œâ”€â”€ index.js                           â† ENTRADA
â”œâ”€â”€ config-manager.js                  â† Gerencia configs
â”œâ”€â”€ room-manager.js                    â† Gerencia salas
â”œâ”€â”€ api-server.js                      â† Rotas HTTP
â”œâ”€â”€ webhook-example.js                 â† Exemplo webhook
â”œâ”€â”€ package.json                       â† DependÃªncias
â”œâ”€â”€ README.md                          â† Doc principal
â”œâ”€â”€ QUICKSTART.md                      â† Setup 5 min
â”œâ”€â”€ ESTRUTURA.md                       â† Arquitetura
â”œâ”€â”€ PTERODACTYL_INTEGRATION.md         â† IntegraÃ§Ã£o
â”œâ”€â”€ EXEMPLOS_API.http                  â† Exemplos
â”œâ”€â”€ RESUMO_REFATORACAO.md              â† Resumo
â”‚
â”œâ”€â”€ src/
â”‚   â””â”€â”€ futsal.js                      â† LÃ³gica do jogo
â”‚
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ cli.js                         â† Gerenciador CLI
â”‚
â”œâ”€â”€ configs/
â”‚   â””â”€â”€ default.json                   â† ConfiguraÃ§Ã£o
â”‚
â”œâ”€â”€ start.sh                           â† Script Linux
â””â”€â”€ start.bat                          â† Script Windows
```

---

## Componentes Principais

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              COMPONENTES PRINCIPAIS                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸ“‹ CONFIG-MANAGER                                      â”‚
â”‚     â”œâ”€ LÃª/escreve configuraÃ§Ãµes                         â”‚
â”‚     â”œâ”€ Gerencia salas na config                         â”‚
â”‚     â””â”€ PersistÃªncia em JSON                             â”‚
â”‚                                                         â”‚
â”‚  ğŸ® ROOM-MANAGER (CLASS)                                â”‚
â”‚     â”œâ”€ Inicializa HaxballJS                             â”‚
â”‚     â”œâ”€ Cria/deleta salas                                â”‚
â”‚     â”œâ”€ Gerencia estado das salas                        â”‚
â”‚     â””â”€ Retorna status                                   â”‚
â”‚                                                         â”‚
â”‚  ğŸŒ API-SERVER (CLASS EXPRESS)                          â”‚
â”‚     â”œâ”€ Autentica requisiÃ§Ãµes                            â”‚
â”‚     â”œâ”€ Roteia endpoints                                 â”‚
â”‚     â”œâ”€ Valida dados                                     â”‚
â”‚     â””â”€ Retorna JSON                                     â”‚
â”‚                                                         â”‚
â”‚  ğŸ® FUTSAL.JS                                           â”‚
â”‚     â”œâ”€ LÃ³gica do jogo                                   â”‚
â”‚     â”œâ”€ Gerencia estatÃ­sticas                            â”‚
â”‚     â”œâ”€ Webhooks Discord                                 â”‚
â”‚     â””â”€ Replay de partidas                               â”‚
â”‚                                                         â”‚
â”‚  âš™ï¸ CLI (scripts/cli.js)                                 â”‚
â”‚     â”œâ”€ Criar salas                                      â”‚
â”‚     â”œâ”€ Listar salas                                     â”‚
â”‚     â”œâ”€ Deletar salas                                    â”‚
â”‚     â””â”€ Manage local                                     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## SequÃªncia: Criar Sala via API

```
Client              APIServer           ConfigMgr        RoomManager
  â”‚                    â”‚                   â”‚                 â”‚
  â”œâ”€ POST /rooms â”€â”€â”€â”€â”€â–¶â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”œâ”€ Valida token    â”‚                 â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”œâ”€ updateRoomConfigâ”€â–¶â”‚                 â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”œâ”€ JSON.write     â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”œâ”€ createRoom()â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚                    â”‚                   â”‚    â”œâ”€ HaxballJS â”‚
  â”‚                    â”‚                   â”‚    â”‚ init       â”‚
  â”‚                    â”‚                   â”‚    â”‚            â”‚
  â”‚                    â”‚                   â”‚    â”œâ”€ futsal.js â”‚
  â”‚                    â”‚                   â”‚    â”‚ load       â”‚
  â”‚                    â”‚                   â”‚    â”‚            â”‚
  â”‚                    â”‚                   â”‚    â””â”€ Ready âœ…   â”‚
  â”‚                    â”‚                   â”‚                 â”‚
  â”‚â—€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                 â”‚
  â”‚ {id: 1, msg: ok}   â”‚                   â”‚                 â”‚
```

---

## Endpoints & Fluxo

```
PUBLIC (Sem autenticaÃ§Ã£o)
â”œâ”€ GET /health              Status do servidor
â”œâ”€ GET /status              Salas online + jogadores
â””â”€ POST /discord-chat       Enviar mensagem

PRIVATE (Com autenticaÃ§Ã£o - Bearer token)
â”œâ”€ GET /rooms               Listar salas
â”œâ”€ POST /rooms              Criar/atualizar
â”œâ”€ DELETE /rooms/:id        Deletar sala
â””â”€ POST /admin-command      Reiniciar/clearbans
```

---

**Diagrama criado: January 2026** ğŸ“…
